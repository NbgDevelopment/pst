@using NbgDev.Pst.App.Models
@using NbgDev.Pst.App.Services

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">Manage Role - @Role.Name</MudText>
    </TitleContent>
    <DialogContent>
        <MudPaper Elevation="0" Class="pa-4 mb-4">
            <MudText Typo="Typo.subtitle2" Class="mb-3">Role Details</MudText>
            <MudTextField @bind-Value="_roleName" 
                          Label="Role Name" 
                          Variant="Variant.Outlined"
                          Required="true"
                          Class="mb-3" />
            <MudTextField @bind-Value="_roleDescription" 
                          Label="Description (optional)" 
                          Variant="Variant.Outlined"
                          Class="mb-3" />
            <MudButton Variant="Variant.Filled" 
                       Color="Color.Primary" 
                       OnClick="UpdateRole" 
                       Disabled="@(string.IsNullOrWhiteSpace(_roleName) || (_roleName == Role.Name && _roleDescription == Role.Description))"
                       Size="Size.Small">
                Update Role
            </MudButton>
        </MudPaper>

        <MudDivider Class="my-4" />

        <MudText Typo="Typo.subtitle2" Class="mb-3">Role Members</MudText>
        <div class="d-flex justify-end mb-4">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="OpenAddMemberDialog" Size="Size.Small">
                Add Member
            </MudButton>
        </div>

        @if (_isLoading)
        {
            <MudProgressCircular Indeterminate="true" />
        }
        else if (_members == null || !_members.Any())
        {
            <MudText>No members assigned to this role yet.</MudText>
        }
        else
        {
            <MudTable Items="_members" Hover="true" Striped="true" Dense="true">
                <HeaderContent>
                    <MudTh>First Name</MudTh>
                    <MudTh>Last Name</MudTh>
                    <MudTh>Email</MudTh>
                    <MudTh>Actions</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="First Name">@context.FirstName</MudTd>
                    <MudTd DataLabel="Last Name">@context.LastName</MudTd>
                    <MudTd DataLabel="Email">@context.Email</MudTd>
                    <MudTd DataLabel="Actions">
                        <MudIconButton Icon="@Icons.Material.Filled.Delete" 
                                       Color="Color.Error" 
                                       OnClick="@(() => ConfirmRemoveMember(context))"
                                       Size="Size.Small" />
                    </MudTd>
                </RowTemplate>
            </MudTable>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close">Close</MudButton>
    </DialogActions>
</MudDialog>
