@using NbgDev.Pst.App.Models
@using NbgDev.Pst.App.Services

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">Add Role Member</MudText>
    </TitleContent>
    <DialogContent>
        <MudTextField @bind-Value="_searchTerm" 
                      Label="Search Project Members" 
                      Variant="Variant.Outlined"
                      Adornment="Adornment.End"
                      AdornmentIcon="@Icons.Material.Filled.Search"
                      OnAdornmentClick="FilterMembers"
                      OnKeyDown="HandleKeyDown"
                      Class="mb-4" />

        @if (_isLoading)
        {
            <MudProgressCircular Indeterminate="true" Size="Size.Small" />
        }
        else if (_filteredMembers.Any())
        {
            <MudList T="string">
                @foreach (var member in _filteredMembers)
                {
                    <MudListItem T="string" OnClick="@(() => SelectMember(member))">
                        <div class="d-flex align-center">
                            <MudAvatar Color="Color.Primary" Class="mr-3">
                                @(GetInitials(member))
                            </MudAvatar>
                            <div>
                                <MudText Typo="Typo.body1">@member.FirstName @member.LastName</MudText>
                                <MudText Typo="Typo.body2" Color="Color.Secondary">@(member.Email ?? "No email")</MudText>
                            </div>
                        </div>
                    </MudListItem>
                }
            </MudList>
        }
        else if (!string.IsNullOrWhiteSpace(_searchTerm))
        {
            <MudText>No project members found matching your search.</MudText>
        }
        else
        {
            <MudText>No project members available.</MudText>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
    </DialogActions>
</MudDialog>
